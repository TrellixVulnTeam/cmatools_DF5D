# ####################################################################
# GitHub workflow action file
# Checks recent gh-pages website builds
# ####################################################################

# Name for workflow (also displayed on the associated badges)
name: site

# Controls when the action will run. Triggers the workflow only if docs workflow succeeds
on: [push]

jobs:
  job:
    runs-on: ubuntu-latest
    steps:
    - name: Confirm documentation gh-pages has built
      id: built
      run: |
        ath="Accept: application/vnd.github.v3+json"
        url="https://api.github.com/repos/cma-open/cmatools/pages"
        response=$(curl -H "${ath}" -u ${{ secrets.ACCESS_TOKEN }} "${url}")
        echo " --***-- "
        echo "${response}"
        echo " --***-- "
        echo "::set-output name=body::"${response}""
    - name: Test the job steps outputs
      id: check
      run: |
        echo "${{ steps.built.outcome }}"
        echo "${{ steps.built.outputs.body }}"
        echo "${{fromJson(steps.built.outputs.body).status}}"
        echo "::set-output name=status::"${{fromJson(steps.built.outputs.body).status}}""
    - name: Check failures
      if: steps.check.outputs.status != 'built'
      run: |
        echo "${{ steps.check.outputs.status }}"
        exit 1
